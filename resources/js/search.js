let info = {
  'osu-student': {
    games: {
      'Florida Atlantic Owls': {
        primary: '#003366',
        secondary: '#CC0000',
        date: '8/31/2019',
        gameNumber: 1,
        time: 'TBA',
        teamNickname: 'Florida Atl.',
        gameOver: false,
        gameScore: [],
      },

      'Cincinnati Bearcats': {
        primary: '#E00122',
        secondary: '#000000',
        date: '9/7/2019',
        gameNumber: 2,
        time: 'TBA',
        teamNickname: 'Cincinnati',
        gameOver: false,
        gameScore: [],
      },

      'Miami RedHawks': {
        primary: '#B61E2E',
        secondary: '#000000',
        date: '9/21/2019',
        gameNumber: 3,
        time: 'TBA',
        teamNickname: 'Miami',
        gameOver: false,
        gameScore: [],
      },

      'Michigan State Spartans': {
        primary: '#18453B',
        secondary: '#FFFFFF',
        date: '10/5/2019',
        gameNumber: 4,
        time: 'TBA',
        teamNickname: 'Michigan State',
        gameOver: false,
        gameScore: [],
      },

      'Wisconsin Badgers': {
        primary: '#C5050C',
        secondary: '#FFFFFF',
        date: '10/26/2019',
        gameNumber: 5,
        time: 'TBA',
        teamNickname: 'Wisconsin',
        gameOver: false,
        gameScore: [],
      },

      'Maryland Terrapins': {
        primary: '#E03A3E',
        secondary: '#FFD520',
        date: '11/3/2018',
        gameNumber: 6,
        time: 'TBA',
        teamNickname: 'Maryland',
        gameOver: false,
        gameScore: [],
      },

      'Penn State Nittany Lions': {
        primary: '#093162',
        secondary: '#FFFFFF',
        date: '11/23/2019',
        gameNumber: 7,
        time: 'TBA',
        teamNickname: 'Penn State',
        gameOver: false,
        gameScore: [],
      },
    },

    sections: [
      { value: 'BON', label: 'Block O North' },
      { value: 'BOS', label: 'Block O South' },
      '1C',
      '2C',
      '3A',
      '3C',
      '4A',
      '5A',
      '5C',
      '6A',
      '7A',
      '7C',
      '9C',
      '31A',
      '31B',
      '32A',
      '32B',
      '33A',
      '33B',
      '34A',
      '34B',
      '35A',
      '35B',
      '36A',
      '36B',
      '37A',
      '37AA',
      '37B',
      '38A',
      '38AA',
      '38B',
      '39B'
    ],

    northSections: [
      'BON',
      '1C',
      '2C',
      '3A',
      '3C',
      '4A',
      '5A',
      '5C',
      '6A',
      '7A',
      '7C',
      '9C'
    ],

    southSections: [
      'BOS',
      '31A',
      '31B',
      '32A',
      '32B',
      '33A',
      '33B',
      '34A',
      '34B',
      '35A',
      '35B',
      '36A',
      '36B',
      '37A',
      '37AA',
      '37B',
      '38A',
      '38AA',
      '38B',
      '39B'
    ],

    rows: [
      '1',
      '2',
      '3',
      '4',
      '5',
      '6',
      '7',
      '8',
      '9',
      '10',
      '11',
      '12',
      '13',
      '14',
      '15',
      '16',
      '17',
      '18',
      '19',
      '20',
      '21',
      '22',
      '23',
      '24',
      '25',
      '26',
      '27',
      '28',
      '29',
      '30',
      '31',
      '32',
      '33',
      '34',
      '35',
      '36',
      '37',
      '38',
      '39',
      '40',
      '41',
      '42',
      '43',
      '44',
      '45'
    ],

    seats: [
      '1',
      '2',
      '3',
      '4',
      '5',
      '6',
      '7',
      '8',
      '9',
      '10',
      '11',
      '12',
      '13',
      '14',
      '15',
      '16',
      '17',
      '18',
      '19',
      '20',
      '21',
      '22',
      '23',
      '24',
      '25',
      '26',
      '27',
      '28',
      '29',
      '30',
      '31',
      '32',
      '33',
      '34',
      '35',
      '36',
      '37',
      '38',
      '39',
      '40',
      '41',
      '42',
      '43',
      '44',
      '45'
    ],
  },

  'osu-faculty': {
    games: {
      'Florida Atlantic Owls': {
        primary: '#003366',
        secondary: '#CC0000',
        date: '8/31/2019',
        gameNumber: 1,
        time: 'TBA',
        teamNickname: 'Florida Atl.',
        gameOver: false,
        gameScore: [],
      },

      'Cincinnati Bearcats': {
        primary: '#E00122',
        secondary: '#000000',
        date: '9/7/2019',
        gameNumber: 2,
        time: 'TBA',
        teamNickname: 'Cincinnati',
        gameOver: false,
        gameScore: [],
      },

      'Miami RedHawks': {
        primary: '#B61E2E',
        secondary: '#000000',
        date: '9/21/2019',
        gameNumber: 3,
        time: 'TBA',
        teamNickname: 'Miami',
        gameOver: false,
        gameScore: [],
      },

      'Michigan State Spartans': {
        primary: '#18453B',
        secondary: '#FFFFFF',
        date: '10/5/2019',
        gameNumber: 4,
        time: 'TBA',
        teamNickname: 'Michigan State',
        gameOver: false,
        gameScore: [],
      },

      'Wisconsin Badgers': {
        primary: '#C5050C',
        secondary: '#FFFFFF',
        date: '10/26/2019',
        gameNumber: 5,
        time: 'TBA',
        teamNickname: 'Wisconsin',
        gameOver: false,
        gameScore: [],
      },

      'Maryland Terrapins': {
        primary: '#E03A3E',
        secondary: '#FFD520',
        date: '11/3/2018',
        gameNumber: 6,
        time: 'TBA',
        teamNickname: 'Maryland',
        gameOver: false,
        gameScore: [],
      },

      'Penn State Nittany Lions': {
        primary: '#093162',
        secondary: '#FFFFFF',
        date: '11/23/2019',
        gameNumber: 7,
        time: 'TBA',
        teamNickname: 'Penn State',
        gameOver: false,
        gameScore: [],
      },
    },

    sections: [
      '9A',
      '11A',
      '13A',
      '22A',
      '25A',
      '27A',
      '27AA',
      '29A',
      '29AA',
      '5B',
      '7B',
      '9B',
      '11B',
      '11C',
      '13C',
      '15C',
      '17C',
      '19C',
      '21C',
      '23C',
      '25C',
      '27C',
      '29C',
      '11D',
      '13D',
      '21D',
      '27D',
      '29D'
    ],

    northSections: [
      '9A',
      '11A',
      '13A',
      '5B',
      '7B',
      '9B',
      '11B',
      '11C',
      '13C',
      '15C',
      '17C',
      '19C',
      '11D',
      '13D'
    ],

    southSections: [
      '22A',
      '25A',
      '27A',
      '27AA',
      '29A',
      '29AA',
      '21C',
      '23C',
      '25C',
      '27C',
      '29C',
      '21D',
      '27D',
      '29D'
    ],

    rows: [
      '1',
      '2',
      '3',
      '4',
      '5',
      '6',
      '7',
      '8',
      '9',
      '10',
      '11',
      '12',
      '13',
      '14',
      '15',
      '16',
      '17',
      '18',
      '19',
      '20',
      '21',
      '22',
      '23',
      '24',
      '25',
      '26',
      '27',
      '28',
      '29',
      '30',
      '31',
      '32',
      '33',
      '34',
      '35',
      '36',
      '37',
      '38',
      '39',
      '40',
      '41',
      '42',
      '43',
      '44',
      '45'
    ],

    seats: [
      '1',
      '2',
      '3',
      '4',
      '5',
      '6',
      '7',
      '8',
      '9',
      '10',
      '11',
      '12',
      '13',
      '14',
      '15',
      '16',
      '17',
      '18',
      '19',
      '20',
      '21',
      '22',
      '23',
      '24',
      '25',
      '26',
      '27',
      '28',
      '29',
      '30',
      '31',
      '32',
      '33',
      '34',
      '35',
      '36',
      '37',
      '38',
      '39',
      '40',
      '41',
      '42',
      '43',
      '44',
      '45'
    ],
  },
}

let ticketComponent = {html:'\
<div class="row">\
  <div class="col-md-8 offset-md-2 border text-white round" style="background-color:{{ secondary }}">\
    <div class="row">\
      <div class="col-md-4 text-center ticket vertical-buffered" style="background-color:{{ primary }}">{{ game }}</div>\
      <div class="col-md-2 text-center vertical-buffered">\
        <div class="font-weight-bold">\
          ${{ price }}\
        </div>\
        Price\
      </div>\
      <div class="col-md-2 text-center vertical-buffered">\
        <div class="font-weight-bold">\
          {{ section }}\
        </div>\
        Section\
      </div>\
      <div class="col-md-2 text-center vertical-buffered">\
        <div class="font-weight-bold">\
          {{ row }}\
        </div>\
        Row\
      </div>\
      <div class="col-md-2 text-center vertical-buffered">\
        <div class="font-weight-bold">\
          {{ seat }}\
        </div>\
        Seat\
      </div>\
    </div>\
  </div>\
</div>\
<br/>'}

let failureMessages = {
  noTickets: 'No tickets available. Try a different game or section.',
  error: 'Unable to fetch data from server.',
}

function populateResults(data){
  var toReplace = ['{{ game }}','{{ price }}','{{ section }}','{{ row }}','{{ seat }}','{{ primary }}','{{ secondary }}'];
  var replaceWith = ["teamNickname","price","section","row","seat","primary","secondary"];

  var $results = $('#results')
  $results.empty();

  if(data["success"] !== true){
    $results.append('<h4>'+failureMessages.error+'</h4>');
  }else if(data["tickets"].length === 0){
    $results.append('<h4>'+failureMessages.noTickets+'</h4>');
  }else{
    $.each(data["tickets"],function(index,ticket){
      ticketElement = ticketComponent.html;
      $.each(toReplace,function(index,placeholder){
        ticketElement = ticketElement.replace(placeholder,ticket[replaceWith[index]]);
      });
      $results.append(ticketElement)
    });
  }
}

function populateSearch(group,field){
  var $fieldSelect = $('#'+field);
  $fieldSelect.empty();

  $fieldSelect.append('<option selected disabled value="">Select '+field+'</option>');
  var data = [];

  if(field === 'game'){
    data = Object.keys(info[group]['games']);
  }else{
    data.push('All');
    if(field === 'section'){
      data.push({value:'North',label:'All North Sections'});
      data.push({value:'South',label:'All South Sections'});
    }
    data = data.concat(info[group][field+'s']);
  }

  $.each(data, function(index, element){
    if(typeof element === 'object'){
      $fieldSelect.append('<option value="'+element.value+'">'+element.label+'</option>');
    }else{
      $fieldSelect.append('<option>'+element+'</option>')
    }
  });
}

function getTickets(){
  var group = $('#group').val();
  var game = $('#game').val();
  var section = $('#section').val();
  var row = $('#row').val();

  if(!row || !section || !game || !group){
    alert("Make sure a valid option for each field is selected");
    return;
  }

  var postObject = JSON.stringify({
    "group": group,
    "game": game,
    "section": section,
    "row": row,
  })

  $.ajax({
    type: 'POST',
    url: 'https://localhost:3000/search/public',
    dataType: 'json',
    contentType: 'application/json',
    data: postObject,
    success: function(data){
      populateResults(data);
    },
    error: function(data){
      populateResults({"success":"false"});
    }
  });

  return false
}

$('#group').change(function(){
  var group = $(this).val();
  populateSearch(group,'game');
  populateSearch(group,'section');
  populateSearch(group,'row')
})
